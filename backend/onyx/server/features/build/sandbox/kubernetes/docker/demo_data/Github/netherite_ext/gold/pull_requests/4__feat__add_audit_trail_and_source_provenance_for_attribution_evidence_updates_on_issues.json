{
  "id": "https://github.com/onyx-dot-app/onyx#4",
  "semantic_identifier": "4: feat: Add audit trail + source provenance for Attribution Evidence updates on Issues",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-11-14",
  "metadata": {
    "object_type": "PullRequest",
    "id": "4",
    "merged": "False",
    "state": "open",
    "user": {
      "login": "michael_anderson",
      "name": "michael_anderson",
      "email": "michael_anderson@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "andre_robinson",
        "name": "andre_robinson",
        "email": "andre_robinson@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "10",
    "num_files_changed": "38",
    "labels": [],
    "created_at": "2025-11-14",
    "updated_at": "2025-11-14",
    "closed_at": ""
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n## Summary\nThis PR adds an auditable change history for all Attribution Evidence field updates on `Issue` objects, including who/what changed the data, when it changed, what changed (old/new values), and where the data came from (stable external source references).\n\n## What changed\n- **New persistence model**: Introduced an `issue_attribution_evidence_audit` (name may vary by schema) table to store immutable audit events:\n  - `issue_id`\n  - `field_key` (which Attribution Evidence field changed)\n  - `old_value` / `new_value` (stored as JSON/text depending on field type)\n  - `changed_at` timestamp\n  - `actor_type` (`USER` | `ENRICHMENT_JOB`)\n  - `actor_id` (user id when applicable) / `job_run_id` (when applicable)\n  - `source_refs` JSON (e.g., `{ crmAccountId, opportunityId, conversationId, ... }`)\n- **Write-path instrumentation**:\n  - Centralized Attribution Evidence updates through a service-layer method that computes diffs and writes audit rows in the same transaction as the `Issue` update.\n  - Enrichment/job writers now attach **stable source pointers** (CRM/opportunity/conversation identifiers) to each audit event.\n  - No-op updates (no value change) do not create audit rows.\n- **API additions**:\n  - Added an endpoint / resolver to fetch attribution evidence audit history for an issue.\n  - Server-side ordering by `changed_at DESC` with basic pagination.\n- **UI (Issue detail view)**:\n  - Added an \u201cAttribution Evidence History\u201d section that renders audit events with:\n    - timestamp\n    - actor (user name or \u201cEnrichment job\u201d)\n    - field name\n    - previous \u2192 new value\n    - source references (displayed as IDs; link-outs where we already support them)\n\n## Operational / migration notes\n- Includes a DB migration to create the audit table and indexes on `(issue_id, changed_at)`.\n- Existing Issue data is not backfilled into history (history starts from deploy time).\n\n## Testing\n- Unit tests for diffing + audit row creation (user updates and enrichment updates).\n- API tests for history retrieval and ordering.\n- UI coverage for rendering history entries and empty state.\r\n\r\n## How Has This Been Tested?\r\n\r\nlocal\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#4"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}