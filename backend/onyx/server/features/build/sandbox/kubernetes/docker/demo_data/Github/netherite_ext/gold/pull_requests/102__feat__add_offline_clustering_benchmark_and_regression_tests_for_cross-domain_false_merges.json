{
  "id": "https://github.com/onyx-dot-app/onyx#102",
  "semantic_identifier": "102: feat: Add offline clustering benchmark + regression tests for cross-domain false merges",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-05-05",
  "metadata": {
    "object_type": "PullRequest",
    "id": "102",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "kenji_watanabe",
      "name": "kenji_watanabe",
      "email": "kenji_watanabe@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "andre_robinson",
        "name": "andre_robinson",
        "email": "andre_robinson@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "7",
    "num_files_changed": "80",
    "labels": [],
    "created_at": "2025-05-05",
    "updated_at": "2025-05-05",
    "closed_at": "2025-05-12"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\nThis PR adds an offline evaluation harness to quantify and prevent over-merging in the issue clustering pipeline across domains/integration sources.\n\nKey changes\n- Benchmark dataset\n  - Introduces a versioned benchmark under `benchmarks/issue_clustering/` containing labeled issue pairs and small clusters sampled from multiple domains (billing, API, mobile) and multiple ingestion sources.\n  - Adds a schema (`benchmark.schema.json`) and loader to normalize fields (domain, source, issue_id, text fields, label/cluster_id) and enforce deterministic splits.\n- Metrics focused on false merges\n  - Implements domain/source-sliced metrics with emphasis on merge precision / false-merge rate:\n    - Pairwise precision/recall/F1\n    - False-merge rate (fraction of predicted-positive pairs that are labeled negative)\n    - Cluster purity / over-merge ratio (when a predicted cluster contains multiple gold clusters)\n  - Outputs both aggregated and per-(domain, source) reports as JSON + human-readable table.\n- Automated regression test\n  - Adds a CI job and test entrypoint (e.g., `scripts/run_clustering_benchmark.py` + `tests/test_clustering_benchmark.py`) that runs the current clustering implementation against the benchmark.\n  - Compares results to stored baselines per domain/source and fails if false-merge rate regresses beyond configured tolerances.\n  - Keeps tolerances intentionally permissive (low-priority guardrail) but blocks large regressions.\n- Threshold recommendation tooling\n  - Adds an optional sweep mode to evaluate similarity thresholds per domain/source and print recommended defaults that meet a target max false-merge rate.\n  - Does not change production thresholds automatically; recommendations are reported for follow-up.\n\nHow to run\n- `python scripts/run_clustering_benchmark.py --benchmark benchmarks/issue_clustering --report out/report.json`\n- Optional threshold sweep: `... --sweep --thresholds 0.60 0.65 0.70 0.75 0.80`\n\nNotes\n- Baselines are pinned to the current main behavior; future clustering changes must update baselines only when improvements are validated.\n- The benchmark is small by design to keep CI runtime low; it is easy to extend by adding new labeled examples via the provided schema.\r\n\r\n## How Has This Been Tested?\r\n\r\nlocal\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#102"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}