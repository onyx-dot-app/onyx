{
  "id": "https://github.com/onyx-dot-app/onyx#34",
  "semantic_identifier": "34: feat: Add persistent AlertEvent model + query APIs with filtering, pagination, and idempotent ingestion",
  "title": null,
  "source": "github",
  "doc_updated_at": "2026-01-21",
  "metadata": {
    "object_type": "PullRequest",
    "id": "34",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "sofia_ramirez",
      "name": "sofia_ramirez",
      "email": "sofia_ramirez@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "andre_robinson",
        "name": "andre_robinson",
        "email": "andre_robinson@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "9",
    "num_files_changed": "43",
    "labels": [],
    "created_at": "2026-01-21",
    "updated_at": "2026-01-21",
    "closed_at": "2026-01-21"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n### Summary\nImplements persistent storage for normalized monitoring alert events (per GOLD-40) and adds read/query APIs to support downstream UI/notification delivery.\n\n### What\u2019s included\n- **Data model / persistence**\n  - Introduces `alert_events` table (or equivalent collection) to store normalized events with:\n    - `id`, `type`\n    - entity references (e.g., `customer_id`, `segment_id`, optional `model_id`/`dataset_id` as applicable)\n    - `evaluated_at` (event timestamp) and `created_at`\n    - computed metrics payload (e.g., drift scores, cohort stats)\n    - thresholds payload (configured limits used for evaluation)\n    - evaluation window (`window_start`, `window_end`)\n    - **`dedupe_key`** for idempotency\n  - Adds indexes optimized for query patterns:\n    - `(type, evaluated_at desc)`\n    - `(customer_id, evaluated_at desc)` / `(segment_id, evaluated_at desc)`\n    - unique index on `dedupe_key` to prevent duplicates\n\n- **Idempotent writes**\n  - Adds an upsert/insert-on-conflict path keyed by `dedupe_key`.\n  - Duplicate ingestions return the existing event (no-op) rather than creating new rows.\n\n- **Retrieval APIs**\n  - `GET /api/alert-events` lists events with:\n    - filters: `type`, `customerId`, `segmentId`, `startTime`, `endTime`\n    - pagination: `limit` + cursor token (ordered by `evaluated_at desc, id desc`)\n  - `GET /api/alert-events/:id` fetches a single event by id.\n  - Response DTOs include core fields + metric/threshold/window payloads.\n\n- **Retention / archival defaults (low-priority monitoring)**\n  - Adds a configurable retention window with a conservative default (e.g., 30\u201390 days) and a lightweight cleanup path (manual job/cron hook) without introducing heavy archival dependencies.\n\n### Notes for reviewers / operators\n- No UI changes; this PR only provides persistence + backend APIs.\n- Existing producers should generate a stable `dedupe_key` (type + entity refs + window + metric identity) to ensure idempotency.\n- Migration required to add the new table/indexes; deploy includes schema migration step.\r\n\r\n## How Has This Been Tested?\r\n\r\nlocal\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#34"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}