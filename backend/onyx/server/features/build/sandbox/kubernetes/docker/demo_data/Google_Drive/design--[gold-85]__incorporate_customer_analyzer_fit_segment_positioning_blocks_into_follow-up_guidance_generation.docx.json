{
  "id": "b80f258938454d44819fdc19573f0bba",
  "semantic_identifier": "Design--[GOLD-85]: Incorporate Customer_Analyzer fit/segment/positioning blocks into follow-up guidance generation.docx",
  "title": null,
  "source": "google_doc",
  "doc_updated_at": "2025-07-13",
  "metadata": {
    "owner_names": ""
  },
  "doc_metadata": {
    "hierarchy": {
      "source_path": [
        "My Drive"
      ],
      "drive_id": null,
      "file_name": "Design--[GOLD-85]: Incorporate Customer_Analyzer fit/segment/positioning blocks into follow-up guidance generation.docx",
      "mime_type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    }
  },
  "sections": [
    {
      "text": "## Summary / Goal\nExtend the follow-up guidance generator to incorporate `Customer_Analyzer` context provided by the retrieval layer\u2014specifically `fit_score`, `segment`, and *approved positioning blocks*\u2014when generating next-step recommendations and suggested messaging for in-flight opportunities. The goal is to make guidance more tailored and consistent while preserving the current behavior when the enrichment data is unavailable or unreliable.\n\n## Data Contract & Integration\nWe will update the guidance generation input schema to optionally accept a `customer_analyzer` payload from retrieval, containing: `(a)` numeric/ordinal `fit_score` plus metadata needed to judge staleness (e.g., timestamp/version), `(b)` `segment` identifier (and optionally display label), and `(c)` a list of approved positioning blocks with stable identifiers and human-readable text. The generator will treat all Customer_Analyzer fields as optional and will gate their usage behind validation checks: presence, mapped segment/fit ranges (if required), and freshness (configurable max age). If validation fails, the generator will skip enrichment and proceed with the existing follow-up logic unchanged.\n\n## Deterministic Positioning Block Selection\nWhen approved positioning blocks are present and valid, the generator will reference a deterministic subset to avoid nondeterministic prompts/outputs. Selection rules: filter to `approved == true`, sort by a stable key (e.g., `rank` ascending if provided, else `block_id`/`created_at`), and take the top `N` (configurable; default 2\u20133). The selected blocks will be injected into the guidance prompt/context in a defined order and formatted consistently (e.g., \u201cPositioning Block 1\u2026\u201d) so downstream generation is repeatable and testable. If no blocks pass filters (or `N=0`), the generator will still use fit/segment (if valid) without blocks, otherwise fully fall back.\n\n## Testing & Rollout\nAdd unit tests with fixtures representing: full valid Customer_Analyzer payload, missing payload, stale payload, unmapped segment, empty/unaligned positioning blocks, and mixed approval states. Assertions will verify that generated guidance includes fit/segment phrasing and references only the deterministically selected approved blocks in stable order; and that the output matches (or is equivalent to) the existing flow when enrichment is invalid. We\u2019ll also add a small contract test at the boundary (retrieval \u2192 generator) to ensure schema compatibility and to prevent silent breakage when retrieval changes field names or shapes.",
      "link": "https://www.onyx.app/26567"
    }
  ],
  "primary_owners": [
    "jason_morris"
  ],
  "secondary_owners": []
}