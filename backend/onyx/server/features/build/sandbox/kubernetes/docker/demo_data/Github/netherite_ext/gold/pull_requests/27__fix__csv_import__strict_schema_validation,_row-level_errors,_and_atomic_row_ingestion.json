{
  "id": "https://github.com/onyx-dot-app/onyx#27",
  "semantic_identifier": "27: fix: CSV import: strict schema validation, row-level errors, and atomic row ingestion",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-05-15",
  "metadata": {
    "object_type": "PullRequest",
    "id": "27",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "sofia_ramirez",
      "name": "sofia_ramirez",
      "email": "sofia_ramirez@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "ryan_murphy",
        "name": "ryan_murphy",
        "email": "ryan_murphy@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "8",
    "num_files_changed": "13",
    "labels": [],
    "created_at": "2025-05-15",
    "updated_at": "2025-05-15",
    "closed_at": "2025-05-25"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\nThis PR hardens the CSV import connector by validating the input schema and values before any persistence, and by returning clear, actionable errors when rows are invalid.\n\nKey changes:\n- Adds a schema contract for CSV imports:\n  - Defines required vs optional columns and supported aliases (e.g., normalized header matching, case/whitespace-insensitive).\n  - Validates types/constraints per field (e.g., non-empty required strings, enum membership, numeric/date parsing where applicable).\n- Introduces a preflight validation step:\n  - Validates headers first and fails fast with a missing/unknown column summary.\n  - Validates each row and collects row-level issues (row number, column name, invalid value, expected format).\n- Makes row ingestion atomic and deterministic:\n  - Ensures a failing row does not partially create themes/issues by wrapping each row\u2019s write path in a transaction (or equivalent atomic unit) and only committing when validation passes.\n  - Processes rows in a stable order and uses consistent normalization to avoid intermittent behavior.\n- Improves error reporting surfaced to the user:\n  - Returns structured error payloads suitable for UI rendering (header errors + per-row errors) and a concise import summary (imported/failed counts).\n\nUser impact:\n- Imports with missing/renamed columns or invalid values now fail with explicit guidance instead of creating malformed objects.\n- Valid rows continue to import successfully; invalid rows are skipped without side effects.\n\nNotes for reviewers:\n- Main logic lives in the CSV parsing/validation layer; persistence is only invoked for rows that pass validation.\n- Includes tests covering missing headers, invalid types, partial-row failures, and deterministic import results.\r\n\r\n## How Has This Been Tested?\r\n\r\nlocal\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#27"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}