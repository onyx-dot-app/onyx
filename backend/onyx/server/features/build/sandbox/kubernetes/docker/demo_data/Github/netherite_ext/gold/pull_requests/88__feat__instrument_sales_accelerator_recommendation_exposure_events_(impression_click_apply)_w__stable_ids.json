{
  "id": "https://github.com/onyx-dot-app/onyx#88",
  "semantic_identifier": "88: feat: Instrument Sales_Accelerator recommendation exposure events (impression/click/apply) w/ stable IDs",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-08-01",
  "metadata": {
    "object_type": "PullRequest",
    "id": "88",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "michael_anderson",
      "name": "michael_anderson",
      "email": "michael_anderson@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "andre_robinson",
        "name": "andre_robinson",
        "email": "andre_robinson@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "1",
    "num_files_changed": "100",
    "labels": [],
    "created_at": "2025-08-01",
    "updated_at": "2025-08-01",
    "closed_at": "2025-08-23"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n## Summary\nAdds structured analytics logging for Sales_Accelerator recommendations to track the full exposure funnel: impression (shown), click, and apply. Each event includes stable identifiers so downstream analysis can reliably join exposures to outcomes.\n\n## What changed\n- Introduced a typed `RecommendationExposureEvent` schema with required fields:\n  - `event_name`: `recommendation_impression` | `recommendation_click` | `recommendation_apply`\n  - `recommendation_id`, `model_version`\n  - `account_id` and/or `opportunity_id` (depending on context)\n  - `user_id`\n  - `timestamp` (UTC, ISO-8601)\n  - `surface` (e.g., Sales_Accelerator list/detail/module identifier)\n  - (optional) `session_id` / `request_id` when available for dedup/debugging\n- Emitted events at the following integration points:\n  - Impression: when recommendation cards are rendered with valid data (deduped per recommendation + surface per page-view/session to avoid overcounting on re-renders).\n  - Click: when a rep opens/engages a recommendation CTA.\n  - Apply: when a rep confirms applying a recommendation action.\n- Routed events through the existing analytics client/pipeline (no new datastore), using the established event sink and batching behavior.\n\n## Validation & safety\n- Added runtime payload validation (non-empty IDs, known event_name/surface, timestamp present) and safe fallbacks (skip logging + warn) to prevent malformed events from entering the pipeline.\n- Added staging verification steps/tests to assert:\n  - all required fields are present for each event type\n  - impression dedupe works across re-renders\n  - click/apply events include the same stable IDs as the originating recommendation\n\n## Notes for reviewers\n- The change is additive and should not affect recommendation generation or UI behavior.\n- If you add a new surface or recommendation entry point later, ensure it passes `surface`, `recommendation_id`, and `model_version` into the shared logger.\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#88"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}