{
  "id": "https://github.com/onyx-dot-app/onyx#113",
  "semantic_identifier": "113: feat: Auto-discover CRM fields and suggest canonical mappings during onboarding",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-05-20",
  "metadata": {
    "object_type": "PullRequest",
    "id": "113",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "michael_anderson",
      "name": "michael_anderson",
      "email": "michael_anderson@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "jiwon_kang",
        "name": "jiwon_kang",
        "email": "jiwon_kang@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "6",
    "num_files_changed": "76",
    "labels": [],
    "created_at": "2025-05-20",
    "updated_at": "2025-05-20",
    "closed_at": "2025-06-10"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n## Summary\nAdds a new onboarding step that scans the connected CRM for commonly used opportunity/deal fields and proposes default mappings to Sales_Accelerator\u2019s canonical schema (stage, close_date, amount, owner, last_activity, etc.). Each suggestion includes a confidence score and can be accepted as-is or edited before saving.\n\n## What\u2019s included\n- **Field auto-discovery**\n  - Fetches CRM object metadata (labels, API names, types, picklist values) for the primary pipeline object (e.g., Opportunity/Deal).\n  - Normalizes field candidates (case/spacing, common synonyms, vendor-specific naming patterns).\n- **Mapping suggestion engine**\n  - Scores candidates per canonical field using weighted heuristics:\n    - name/label similarity + synonym dictionary (e.g., \u201cClose Date\u201d, \u201cExpected Close\u201d, \u201cProjected Close\u201d)\n    - type compatibility checks (date/currency/user reference/picklist)\n    - presence/shape of picklist values for stage-like fields\n    - optional usage signals when available (non-null rate / \u201crequired\u201d flags)\n  - Produces a best match (and alternates) with **confidence indicators** (High/Medium/Low) derived from score thresholds.\n- **Onboarding UI step**\n  - Presents suggested mappings in a table with confidence, selected CRM field, and alternates.\n  - Allows quick **Accept**, **Edit**, and **Clear** per canonical field.\n  - Validates required canonical mappings (e.g., stage) and blocks continue until satisfied.\n- **Persistence & APIs**\n  - Extends mapping config model to store: chosen CRM field id/key, canonical field, confidence score, and whether it was auto-suggested.\n  - Adds/updates endpoints to:\n    - `GET /onboarding/mappings/suggestions` (compute suggestions)\n    - `POST /onboarding/mappings` (save accepted/edited mappings)\n\n## Implementation notes\n- Suggestion computation is server-side to keep credentials/metadata handling centralized and to ensure deterministic scoring.\n- Heuristics are designed to be safe by default: low-confidence suggestions are surfaced but not auto-applied.\n- Logging/metrics added for suggestion acceptance rates and common overrides to refine heuristics over time.\n\n## User impact\nDuring setup, users will see a new \u201cField Mapping\u201d step that pre-fills likely CRM mappings. Users can accept everything in one pass or adjust individual mappings before continuing.\n\n## Testing\n- Unit tests for scoring/threshold logic (synonyms, type mismatch rejection, tie-breaking).\n- Integration tests mocking CRM metadata responses to validate end-to-end suggestion + save flow.\n- UI tests for accept/edit/clear interactions and required-field validation.\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#113"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}