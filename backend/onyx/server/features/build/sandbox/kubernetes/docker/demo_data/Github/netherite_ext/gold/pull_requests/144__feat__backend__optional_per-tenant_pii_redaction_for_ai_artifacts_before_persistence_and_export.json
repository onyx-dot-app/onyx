{
  "id": "https://github.com/onyx-dot-app/onyx#144",
  "semantic_identifier": "144: feat: Backend: Optional per-tenant PII redaction for AI artifacts before persistence and export",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-11-26",
  "metadata": {
    "object_type": "PullRequest",
    "id": "144",
    "merged": "False",
    "state": "open",
    "user": {
      "login": "michael_anderson",
      "name": "michael_anderson",
      "email": "michael_anderson@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "jiwon_kang",
        "name": "jiwon_kang",
        "email": "jiwon_kang@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "1",
    "num_files_changed": "65",
    "labels": [],
    "created_at": "2025-11-26",
    "updated_at": "2025-11-26",
    "closed_at": ""
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n### Summary\nAdds an opt-in, server-side PII detection/redaction step for AI-generated artifacts (emails, call notes, next-best-action text) so sensitive data is masked **before** we persist content and **before** any export/share/API responses return it.\n\n### Key changes\n- **Per-tenant feature flag**: `ai_pii_redaction_enabled` (default: `false`). When disabled, behavior is unchanged.\n- **Centralized redaction service**:\n  - Introduces a single backend redaction pipeline (e.g., `PiiRedactionService`) that accepts freeform text and returns `{ redactedText, findings, policyVersion }`.\n  - Current detectors cover common PII patterns (email, phone, address-like strings) and replace matches with stable placeholders (e.g., `[REDACTED_EMAIL]`).\n- **Write-path enforcement (no raw PII at rest when enabled)**:\n  - AI artifact creation/update handlers invoke the redaction service **before** calling existing persistence/retention/audit flows.\n  - Storage is updated to persist only the redacted content when the flag is enabled.\n- **Read/export-path enforcement**:\n  - Export/share endpoints return redacted content consistently, without duplicating RBAC/audit/retention logic.\n  - Uses existing data access paths; the main change is ensuring any AI artifact content returned is the already-redacted value.\n- **Metadata/audit safety**:\n  - Adds metadata fields on artifacts indicating `redactionApplied=true`, `redactionPolicyVersion`, and optional counts/types of findings.\n  - Ensures audit/event payloads do **not** include raw text when redaction is enabled (no raw PII leakage).\n\n### Implementation notes\n- Redaction is invoked from the shared artifact service layer used by both UI and API entrypoints to avoid drift.\n- Policy/version is centrally defined so future rule updates can be tracked via metadata.\n\n### User impact / rollout\n- Feature is **off by default**; enable per tenant to start storing and exporting only redacted AI artifact content.\n- Once enabled, previously stored artifacts are not automatically backfilled in this PR (forward-only behavior).\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#144"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}