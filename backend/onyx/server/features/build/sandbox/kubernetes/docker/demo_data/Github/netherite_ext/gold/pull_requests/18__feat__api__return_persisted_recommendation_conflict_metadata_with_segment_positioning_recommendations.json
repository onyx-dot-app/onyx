{
  "id": "https://github.com/onyx-dot-app/onyx#18",
  "semantic_identifier": "18: feat: API: Return persisted recommendation conflict metadata with segment positioning recommendations",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-07-23",
  "metadata": {
    "object_type": "PullRequest",
    "id": "18",
    "merged": "False",
    "state": "open",
    "user": {
      "login": "kenji_watanabe",
      "name": "kenji_watanabe",
      "email": "kenji_watanabe@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "kevin_sullivan",
        "name": "kevin_sullivan",
        "email": "kevin_sullivan@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "5",
    "num_files_changed": "85",
    "labels": [],
    "created_at": "2025-07-23",
    "updated_at": "2025-07-23",
    "closed_at": ""
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n## Overview\nThis PR adds API support for returning persisted recommendation conflict metadata (stored via GOLD-32) alongside positioning recommendations for one or more segments, enabling segment positioning views to display conflicts.\n\n## What\u2019s included\n- **New/extended endpoint behavior**: positioning recommendations APIs now optionally include a `conflicts` payload per segment when requested.\n- **Stable response schema**: introduces a versioned/explicit schema for conflict metadata, including:\n  - `segmentId` (source segment)\n  - `conflictingSegmentIds[]`\n  - `category` / `field` (the recommendation category + specific field that conflicts)\n  - `statements[]` (the conflicting statements/values as persisted)\n  - `createdAt` / `updatedAt` (when available)\n- **Filtering & pagination**:\n  - Supports optional query params to filter conflicts by `category`, `field`, and/or `segmentId`.\n  - Paginates conflict records with cursor-based pagination to support UI rendering at scale.\n- **Workspace isolation**: conflict records are scoped strictly to the requesting workspace; the API enforces workspace ownership checks when joining recommendations to persisted conflicts.\n\n## Implementation details\n- Adds a conflict metadata data-access layer that queries persisted conflict records keyed by `(workspaceId, segmentId)` and batches lookups to avoid N+1.\n- Extends the recommendations service layer to merge conflict metadata into the recommendation response, gated behind an `includeConflicts=true` flag to avoid extra DB work for callers that don\u2019t need it.\n- Adds/updates serializers to ensure a stable, backward-compatible JSON shape (no leaking of internal DB schema).\n\n## Tests\n- Adds integration tests covering:\n  - returning conflicts for single and multi-segment requests\n  - workspace scoping (no cross-workspace leakage)\n  - pagination and filter behavior\n  - response schema contract (required fields and types)\n\n## Notes for consumers\n- Clients should request conflicts via `includeConflicts=true` (or the equivalent param added in this PR).\n- Pagination cursors are required when iterating large conflict sets; UI should not assume all conflicts are returned in a single response.\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#18"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}