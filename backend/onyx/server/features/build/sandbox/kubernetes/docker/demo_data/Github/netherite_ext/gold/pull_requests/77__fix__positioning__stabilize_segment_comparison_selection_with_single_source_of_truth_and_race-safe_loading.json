{
  "id": "https://github.com/onyx-dot-app/onyx#77",
  "semantic_identifier": "77: fix: Positioning: Stabilize segment comparison selection with single source of truth + race-safe loading",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-08-03",
  "metadata": {
    "object_type": "PullRequest",
    "id": "77",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "sofia_ramirez",
      "name": "sofia_ramirez",
      "email": "sofia_ramirez@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "tyler_jenkins",
        "name": "tyler_jenkins",
        "email": "tyler_jenkins@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "5",
    "num_files_changed": "44",
    "labels": [],
    "created_at": "2025-08-03",
    "updated_at": "2025-08-03",
    "closed_at": "2025-08-21"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n## Summary\nFixes intermittent stale/incorrect segment comparison data in the Positioning workspace when users switch segments quickly or navigate back/forward. The comparison UI now always reflects the currently selected primary + comparison segments, and data loading is deterministic.\n\n## Key changes\n- **Single source of truth for selection**\n  - Consolidated primary/comparison segment selection state into a single shared store/hook used by both the selector UI and the comparison panel.\n  - Derived UI (labels, selected IDs, enabled/disabled states) from this canonical state to avoid drift between components.\n\n- **Deterministic, race-safe data fetching**\n  - Introduced request versioning / cancellation (via `AbortController` where supported) for segment comparison fetches.\n  - On every selection change, any in-flight request is aborted/invalidated; only the latest request is allowed to commit results.\n  - Added explicit loading/error/reset transitions when selections change to prevent briefly rendering stale results.\n\n- **Navigation/back handling**\n  - Ensured selection is rehydrated consistently on mount and when route/query params change.\n  - Prevented \u201clate response wins\u201d scenarios when returning to the workspace after navigation.\n\n- **Basic logging for verification/debugging**\n  - Added lightweight debug logs for: selection changes, fetch start, fetch completion/abort, and ignored stale responses.\n  - Logs are scoped to the Positioning comparison flow and intended for short-term validation and future incident triage.\n\n## User impact\n- Comparison results should no longer \u201cflip\u201d to a previously selected segment or show stale data after rapid switching or navigation.\n- Loading states are more consistent immediately after changing either segment.\n\n## Notes for reviewers\n- Focus on the new selection state flow (single source of truth) and the fetch lifecycle guards (abort/version checks) to confirm we cannot commit stale responses.\n- Logging is intentionally minimal and can be adjusted/removed once confidence is high.\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#77"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}