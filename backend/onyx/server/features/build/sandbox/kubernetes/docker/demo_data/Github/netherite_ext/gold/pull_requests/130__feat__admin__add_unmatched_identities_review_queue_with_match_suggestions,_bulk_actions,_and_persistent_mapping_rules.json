{
  "id": "https://github.com/onyx-dot-app/onyx#130",
  "semantic_identifier": "130: feat: Admin: add Unmatched Identities review queue with match suggestions, bulk actions, and persistent mapping rules",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-06-01",
  "metadata": {
    "object_type": "PullRequest",
    "id": "130",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "kenji_watanabe",
      "name": "kenji_watanabe",
      "email": "kenji_watanabe@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "kevin_sullivan",
        "name": "kevin_sullivan",
        "email": "kevin_sullivan@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "6",
    "num_files_changed": "20",
    "labels": [],
    "created_at": "2025-06-01",
    "updated_at": "2025-06-01",
    "closed_at": "2025-06-15"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n### Overview\nImplements an admin-facing workflow to review and resolve ticket identities that could not be automatically linked to an existing account. Adds a new \u201cUnmatched identities\u201d queue that surfaces raw + canonicalized identity signals, suggests likely account matches, and supports single and bulk resolution actions. Resolutions are persisted as explicit mapping rules so subsequent ingests auto-link without re-review.\n\n### What\u2019s included\n- **New admin page/route: Unmatched identities**\n  - Lists identities where the ingest/linking pipeline produced `UNMATCHED` (or equivalent) status.\n  - Displays **raw** signals (e.g., email, name, company/domain, external IDs) and **canonicalized** values used by matching.\n  - Adds filtering and grouping for repeated identities (same canonical email/domain/company) to enable bulk operations.\n\n- **Match suggestions panel**\n  - For each unmatched identity, computes **top N candidate accounts** using the existing matching heuristics (email exact/canonical match, domain/company similarity, name similarity, external IDs where present).\n  - Renders candidate accounts with score/reason breakdown (e.g., \u201cdomain match + name similar\u201d).\n\n- **Resolution actions**\n  - **Confirm link**: attach identity to selected account.\n  - **Create new account**: creates account from canonicalized identity fields and links.\n  - **Ignore/Unknown**: marks identity as ignored so it stops appearing in the queue.\n  - **Bulk actions**: apply confirm-link / ignore across all unmatched identities sharing the same canonical key (email, domain, company).\n\n- **Persistent overrides (mapping rules)**\n  - On confirm-link or bulk-link, writes an explicit **identity mapping rule** (e.g., canonical email \u2192 account_id, domain \u2192 account_id, or company \u2192 account_id depending on the chosen bulk key).\n  - Ingest/linking pipeline checks these rules first to auto-link future identities before running heuristic matching.\n\n### Implementation notes (high level)\n- Adds backend endpoints for:\n  - fetching paginated unmatched identities with raw + canonical fields\n  - fetching match suggestions per identity\n  - resolving identities (single + bulk)\n  - CRUD for stored mapping rules (internal use by the resolver)\n- Adds DB support for:\n  - unmatched identity records (or exposes existing table/state)\n  - mapping rules table with unique constraints on (rule_type, canonical_value)\n  - audit fields (created_by, created_at) for admin actions\n- Updates the linking pipeline to:\n  - consult mapping rules prior to heuristic matching\n  - skip/ignore identities marked ignore/unknown\n\n### User impact / how to use\nAdmins can open **Admin \u2192 Unmatched identities**, review suggested matches, and either link, create, or ignore. Bulk actions are recommended when multiple identities share the same canonical email/domain/company; those actions will create mapping rules so future ingests automatically link without manual cleanup.\n\n### Notes\nDesigned to be minimally invasive to the existing ingest pipeline (medium priority): adds an overrides layer + admin tooling without changing core matching scoring logic beyond exposing it for suggestions.\r\n\r\n## How Has This Been Tested?\r\n\r\nlocal\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#130"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}