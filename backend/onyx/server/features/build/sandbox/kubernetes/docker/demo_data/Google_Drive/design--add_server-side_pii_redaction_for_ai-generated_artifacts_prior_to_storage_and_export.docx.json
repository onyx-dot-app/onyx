{
  "id": "fd7e85a96b044faabfb06ce93c562add",
  "semantic_identifier": "Design--Add server-side PII redaction for AI-generated artifacts prior to storage and export.docx",
  "title": null,
  "source": "google_doc",
  "doc_updated_at": "2025-10-28",
  "metadata": {
    "owner_names": ""
  },
  "doc_metadata": {
    "hierarchy": {
      "source_path": [
        "My Drive"
      ],
      "drive_id": null,
      "file_name": "Design--Add server-side PII redaction for AI-generated artifacts prior to storage and export.docx",
      "mime_type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    }
  },
  "sections": [
    {
      "text": "We will introduce a server-side PII detection and redaction step in the artifact lifecycle for AI-generated outputs (emails, call notes, next-best-action text) so that sensitive fields (e.g., email addresses, phone numbers, postal addresses) are masked before any persistence and before any export/share APIs return content. This will be implemented as a backend \u201cartifact sanitizer\u201d stage that runs after generation but before storage, producing a redacted canonical representation that becomes the only persisted/exportable body when enabled. The goal is to ensure a single, consistent enforcement point shared by all UI and API entrypoints, without re-implementing RBAC checks, audit logging, or retention/deletion logic in multiple places.\n\nRedaction will be controlled via a per-tenant configuration flag (default: off). When enabled, all eligible artifact writes (create/update of AI-generated body fields) must pass through the sanitizer. The sanitizer will apply a versioned policy (e.g., `pii_redaction_policy=v1`) using a PII detector (vendor or in-house) that emits spans/labels and produces a masked output (e.g., `***@***.com`, `(***) ***-****`, `[REDACTED_ADDRESS]`). If detection fails or times out, behavior should be deterministic (e.g., fail-closed for persistence/export of new AI artifacts, or fall back to storing a fully masked placeholder) and explicitly recorded as an error state to avoid silently storing raw PII when the flag is enabled.\n\nWe will persist only the redacted artifact content when the tenant flag is enabled; raw AI output will not be written to the primary artifact store, secondary indices, caches, or search. We will store redaction metadata alongside the artifact (e.g., `redaction_applied=true`, `policy_version`, `detected_types`, `timestamp`, optional `confidence_summary`) to support debugging and compliance reporting, but we will not store extracted PII values or match spans that could reconstruct sensitive data. Downstream systems that currently consume artifact bodies (rendering, exports, share links, webhooks) will continue to use the same artifact read path; they will simply receive the already-redacted canonical body, ensuring consistent behavior across UI and API without branching logic in each endpoint.\n\nAudit/event logging must be updated so that when redaction is enabled, no raw PII from artifact bodies is ever included in audit payloads, diffs, or analytics events. The sanitizer stage will run prior to emitting any artifact-related events, and any existing logging hooks that capture request/response bodies will be switched to log only redaction metadata (policy/version and a boolean that redaction occurred) or a fixed-length hash of the redacted content if needed for correlation. This preserves RBAC, audit, and retention semantics while guaranteeing that enabling the tenant flag prevents raw PII from being stored or exported through primary content, logs, or event streams.",
      "link": "https://www.onyx.app/90679"
    }
  ],
  "primary_owners": [
    "jiwon_kang"
  ],
  "secondary_owners": []
}