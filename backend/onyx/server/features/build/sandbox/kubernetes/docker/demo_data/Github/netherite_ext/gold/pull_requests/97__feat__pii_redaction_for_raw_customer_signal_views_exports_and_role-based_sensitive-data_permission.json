{
  "id": "https://github.com/onyx-dot-app/onyx#97",
  "semantic_identifier": "97: feat: PII redaction for raw customer signal views/exports + role-based sensitive-data permission",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-11-03",
  "metadata": {
    "object_type": "PullRequest",
    "id": "97",
    "merged": "False",
    "state": "open",
    "user": {
      "login": "michael_anderson",
      "name": "michael_anderson",
      "email": "michael_anderson@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "jason_morris",
        "name": "jason_morris",
        "email": "jason_morris@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "5",
    "num_files_changed": "20",
    "labels": [],
    "created_at": "2025-11-03",
    "updated_at": "2025-11-03",
    "closed_at": ""
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\n## Summary\nImplements a PII classification + redaction layer for ingested customer signals so raw-record UI views and export/download payloads return masked sensitive values by default. Adds an explicit workspace permission (\"view sensitive data\") to allow admins to grant unredacted access per role. Applies the same redaction rules across the API responses used by both the UI and export endpoints.\n\n## Key changes\n- **PII detection/classification**\n  - Introduces a server-side PII classifier that detects common PII patterns in raw signal fields (including free-text), such as emails, phone numbers, addresses, and other high-risk identifiers.\n  - Supports field-name hints (e.g., keys containing `email`, `phone`, `address`, `notes`) and pattern-based detection for unstructured values.\n\n- **Redaction middleware/service**\n  - Adds a centralized redaction step that runs on raw signal read paths before serialization.\n  - Default behavior: **mask values** (e.g., partial masking or full replacement token) while preserving non-PII fields unchanged.\n  - Ensures redaction is applied consistently to:\n    - Raw customer signal record endpoints used by the UI\n    - Export/download endpoints\n\n- **Authorization: \"view sensitive data\" permission**\n  - Extends RBAC with a dedicated permission flag.\n  - Workspace admins can enable unredacted access per role.\n  - API response shape remains the same; only the values differ (masked vs. original) based on permission.\n\n- **Pipeline safety**\n  - Confirms fit-score/positioning pipelines are unaffected by ensuring redaction occurs only at read/response time for raw views/exports and does not alter the underlying non-PII features used downstream.\n\n## Tests\n- Unit tests for common PII patterns (email/phone/address/free-text)\n- Integration tests covering:\n  - Default masked responses for raw-view and export endpoints\n  - Unredacted responses when the caller role has \"view sensitive data\"\n  - Regression checks ensuring no changes to fit-score/positioning feature inputs\n\n## Notes for reviewers / operators\n- No UI changes are required for masking to take effect; existing raw-record screens and exports will automatically receive redacted values unless the caller has the new permission.\n- Admins must explicitly grant \"view sensitive data\" to roles that require unredacted access.\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#97"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}