{
  "id": "1d5820f0436f4751bda301ce0118fc40",
  "semantic_identifier": "Design--Instrument analytics for stale/manual positioning block usage and replacement actions.docx",
  "title": null,
  "source": "google_doc",
  "doc_updated_at": "2025-05-24",
  "metadata": {
    "owner_names": ""
  },
  "doc_metadata": {
    "hierarchy": {
      "source_path": [
        "My Drive"
      ],
      "drive_id": null,
      "file_name": "Design--Instrument analytics for stale/manual positioning block usage and replacement actions.docx",
      "mime_type": "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    }
  },
  "sections": [
    {
      "text": "### Overview  \nWe will instrument product analytics for the Customer_Analyzer (CA) \u201cstale/manual positioning block\u201d detection and replacement flow to quantify (1) how often users introduce outdated blocks via paste/edit, (2) how frequently staleness is detected, (3) whether warnings are shown, and (4) what users do next (keep vs replace). This telemetry will enable downstream reporting by account/opportunity and CA canonical version, and will help us evaluate whether the current UX reduces stale content over time.\n\n### Event model and payload schema  \nWe will emit four primary events: `ca_positioning_block_modified` (triggered on paste and relevant edits; includes `source: paste|edit`), `ca_positioning_block_staleness_evaluated` (emitted whenever the staleness check runs; includes `result: fresh|stale|unknown` plus reason codes), `ca_positioning_block_stale_warning_shown` (only when the UI warning is displayed), and `ca_positioning_block_stale_user_action` (triggered on user choice; includes `action: keep|replace`). All events will include `account_id`, `opportunity_id`, `document_id` (or equivalent editor surface identifier), `block_instance_id` (stable per inserted block), and canonical CA metadata: `canonical_ca_version` and `canonical_ca_updated_at`. Where available, we will also attach `block_detected_version`/`block_detected_updated_at` parsed from the inserted block to enable mismatch analysis, plus `client_timestamp` and `request_id` for correlation.\n\n### Instrumentation points and data flow  \nOn the client/editor, we will detect block insert/modify actions and emit `ca_positioning_block_modified` with minimal synchronous overhead (batched/queued). The existing staleness detection call/site will emit `ca_positioning_block_staleness_evaluated` with the computed outcome and canonical metadata fetched from the same source used by the validator. If the UI renders a stale warning, we emit `ca_positioning_block_stale_warning_shown` once per block instance per session/view to avoid event spam. When the user selects keep/replace, we emit `ca_positioning_block_stale_user_action`, and in the replace path we additionally include `replacement_applied: true` and the resulting `block_detected_version` if the new block can be re-parsed immediately after insertion.\n\n### Validation, rollout, and documentation  \nWe will validate end-to-end in staging by exercising paste/edit flows, forcing stale/fresh outcomes, and verifying event arrival, required fields, and correct correlation across the four event types for a single `block_instance_id`. We\u2019ll add lightweight automated checks (e.g., schema validation in the analytics wrapper and a staging \u201cgolden flow\u201d test) to prevent regressions. Finally, we will document the event schemas, field definitions, and example payloads in a shared doc for downstream analytics/reporting, including suggested funnels (modified \u2192 stale evaluated \u2192 warning shown \u2192 keep/replace) and recommended joins on `account_id`, `opportunity_id`, and `block_instance_id`.",
      "link": "https://www.onyx.app/29911"
    }
  ],
  "primary_owners": [
    "tyler_jenkins"
  ],
  "secondary_owners": []
}