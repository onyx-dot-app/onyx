{
  "id": "https://github.com/onyx-dot-app/onyx#60",
  "semantic_identifier": "60: feat: Add rate limiting + idempotency guardrails for Jira auto-routing/auto-creation",
  "title": null,
  "source": "github",
  "doc_updated_at": "2025-11-01",
  "metadata": {
    "object_type": "PullRequest",
    "id": "60",
    "merged": "True",
    "state": "closed",
    "user": {
      "login": "michael_anderson",
      "name": "michael_anderson",
      "email": "michael_anderson@netherite-extraction.onyx.app"
    },
    "assignees": [
      {
        "login": "kevin_sullivan",
        "name": "kevin_sullivan",
        "email": "kevin_sullivan@netherite-extraction.onyx.app"
      }
    ],
    "repo": "netherite-ext/gold",
    "num_commits": "2",
    "num_files_changed": "12",
    "labels": [],
    "created_at": "2025-11-01",
    "updated_at": "2025-11-01",
    "closed_at": "2025-11-07"
  },
  "doc_metadata": {
    "repo": "netherite-ext/gold",
    "hierarchy": {
      "source_path": [
        "netherite-ext",
        "gold",
        "pull_requests"
      ],
      "owner": "netherite-ext",
      "repo": "gold",
      "object_type": "pull_request"
    }
  },
  "sections": [
    {
      "text": "## Description\r\n\r\nThis PR adds backend safeguards to prevent Jira spam and ownership thrash caused by retries, webhook replays, and repeated cluster/dedupe updates.\n\nChanges:\n- Per-workspace rate limiting for Jira auto-creation/auto-routing actions.\n  - Introduces a workspace-scoped limiter (configurable window + max attempts) enforced before calling Jira APIs.\n  - Returns a structured \u201cblocked\u201d result (no-op) when the limit is exceeded.\n- Strict idempotency for Issue -> Jira issue creation.\n  - Requires/derives a deterministic idempotency key per (workspace, issue_id, integration_connection, target_project) and persists it with the created Jira issue reference.\n  - On subsequent attempts with the same key, short-circuits and returns the existing Jira issue instead of creating a duplicate.\n  - Makes creation path safe across request retries and webhook replay by using an atomic insert/unique constraint on the idempotency key.\n- Auto-routing dedupe protection.\n  - Adds routing no-op checks to avoid repeatedly re-applying the same owner/route when the target state matches the current state.\n  - Records routing attempts that were blocked due to rate limit / idempotency / no-op.\n- Observability + auditing.\n  - Adds structured logs and metrics counters for allowed vs blocked attempts.\n  - Persists blocked-attempt events with reason codes (RATE_LIMITED, IDEMPOTENT_REPLAY, ROUTE_NOOP) and relevant identifiers (workspace, issue, integration).\n\nOperational notes:\n- Rate limit thresholds are workspace-scoped and can be tuned via config without code changes.\n- Existing Jira links are respected; creation will not run if an issue is already linked unless explicitly forced (not introduced here).\n- No UI changes; behavior is visible via logs/metrics and stored blocked-attempt records for audit/tuning.\r\n\r\n## How Has This Been Tested?\r\n\r\nstaging\r\n",
      "link": "https://github.com/onyx-dot-app/onyx#60"
    }
  ],
  "primary_owners": [],
  "secondary_owners": []
}